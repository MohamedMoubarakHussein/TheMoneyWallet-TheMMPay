<div class="security-settings-container animate-fade-in">
  <header class="page-header animate-slide-down">
    <div class="header-content">
      <h1 class="page-title">Security Settings</h1>
      <p class="page-description">Manage your account security and privacy preferences</p>
    </div>
  </header>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading security settings...</p>
  </div>

  <!-- Main Content -->
  <div class="security-content" *ngIf="!isLoading && securitySettings">
    <!-- Account Protection Section -->
    <section class="security-section animate-slide-right">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-shield-alt"></i>
          Account Protection
        </h2>
      </div>

      <div class="security-card">
        <div class="security-item">
          <div class="item-header">
            <div class="item-info">
              <h3 class="item-title">Two-Factor Authentication</h3>
              <p class="item-description">Add an extra layer of security to your account</p>
            </div>
            <div class="item-status">
              <span [class]="securitySettings.twoFactorEnabled ? 'status-enabled' : 'status-disabled'">
                {{ securitySettings.twoFactorEnabled ? 'Enabled' : 'Disabled' }}
              </span>
            </div>
          </div>
          
          <div class="item-details" *ngIf="securitySettings.twoFactorEnabled">
            <div class="detail-group">
              <span class="detail-label">Method:</span>
              <span class="detail-value">
                <i [class]="'fas ' + (securitySettings.twoFactorMethod === 'authenticator' ? 'fa-key' : 
                                    securitySettings.twoFactorMethod === 'sms' ? 'fa-mobile-alt' : 'fa-envelope')"></i>
                {{ getTwoFactorMethodDisplayName(securitySettings.twoFactorMethod) }}
              </span>
            </div>
          </div>

          <div class="item-actions">
            <button 
              class="btn-primary" 
              *ngIf="!securitySettings.twoFactorEnabled" 
              (click)="toggleTwoFactorSetup()"
            >
              Enable 2FA
            </button>
            <button 
              class="btn-secondary" 
              *ngIf="securitySettings.twoFactorEnabled" 
              (click)="disableTwoFactor()"
            >
              Disable 2FA
            </button>
          </div>
        </div>

        <!-- Two-Factor Setup Form -->
        <div class="setup-form" *ngIf="showTwoFactorSetup" [@cardAnimation]>
          <form [formGroup]="twoFactorForm" (ngSubmit)="setupTwoFactor()">
            <h4 class="form-title">Setup Two-Factor Authentication</h4>
            
            <div class="form-group">
              <label for="method">Authentication Method</label>
              <select 
                id="method" 
                formControlName="method" 
                class="form-control"
              >
                <option value="authenticator">Authenticator App</option>
                <option value="sms">SMS</option>
                <option value="email">Email</option>
              </select>
            </div>

            <div class="form-group" *ngIf="twoFactorForm.get('method')?.value === 'sms'">
              <label for="phoneNumber">Phone Number</label>
              <input 
                type="tel" 
                id="phoneNumber" 
                formControlName="phoneNumber" 
                class="form-control"
                placeholder="+1 (555) 123-4567"
              >
            </div>

            <div class="form-group" *ngIf="twoFactorForm.get('method')?.value === 'email'">
              <label for="email">Email Address</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email" 
                class="form-control"
                placeholder="your@email.com"
              >
            </div>

            <div class="form-group" *ngIf="twoFactorForm.get('method')?.value === 'authenticator'">
              <label>Scan QR Code</label>
              <div class="qr-container">
                <div class="qr-code-placeholder">
                  <i class="fas fa-qrcode"></i>
                </div>
                <div class="qr-instructions">
                  <p>1. Open your authenticator app</p>
                  <p>2. Tap + or Add Account</p>
                  <p>3. Scan this QR code</p>
                </div>
              </div>
              <div class="manual-code">
                <span class="code-label">Manual entry code:</span>
                <span class="code-value">ABCD-EFGH-IJKL-MNOP</span>
              </div>
            </div>

            <div class="form-group">
              <label for="code">Verification Code</label>
              <input 
                type="text" 
                id="code" 
                formControlName="code" 
                class="form-control"
                placeholder="Enter the 6-digit code"
                maxlength="6"
              >
              <div class="error-message" *ngIf="twoFactorForm.get('code')?.invalid && twoFactorForm.get('code')?.touched" [@errorAnimation]>
                Please enter the verification code
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="toggleTwoFactorSetup()">Cancel</button>
              <button type="submit" class="btn-primary" [disabled]="twoFactorForm.invalid">Verify & Enable</button>
            </div>
          </form>
        </div>
      </div>

      <div class="security-card">
        <div class="security-item">
          <div class="item-header">
            <div class="item-info">
              <h3 class="item-title">Password</h3>
              <p class="item-description">Change your account password regularly for better security</p>
            </div>
            <div class="item-status">
              <span class="status-info">
                Last changed {{ securitySettings.lastPasswordChange | date:'mediumDate' }}
              </span>
            </div>
          </div>

          <div class="item-actions">
            <button class="btn-primary" (click)="togglePasswordChange()">
              Change Password
            </button>
          </div>
        </div>

        <!-- Password Change Form -->
        <div class="setup-form" *ngIf="showPasswordChange" [@cardAnimation]>
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <h4 class="form-title">Change Password</h4>
            
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input 
                type="password" 
                id="currentPassword" 
                formControlName="currentPassword" 
                class="form-control"
              >
              <div class="error-message" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched" [@errorAnimation]>
                Please enter your current password
              </div>
            </div>

            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input 
                type="password" 
                id="newPassword" 
                formControlName="newPassword" 
                class="form-control"
              >
              <div class="error-message" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" [@errorAnimation]>
                Password must be at least 8 characters long
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input 
                type="password" 
                id="confirmPassword" 
                formControlName="confirmPassword" 
                class="form-control"
              >
              <div class="error-message" *ngIf="(passwordForm.get('confirmPassword')?.touched || passwordForm.touched) && passwordForm.errors?.['passwordMismatch']" [@errorAnimation]>
                Passwords do not match
              </div>
            </div>

            <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
              <div class="strength-title">Password Strength:</div>
              <div class="strength-meter" [ngClass]="{
                'weak': passwordForm.get('newPassword')?.value.length < 8,
                'medium': passwordForm.get('newPassword')?.value.length >= 8 && passwordForm.get('newPassword')?.value.length < 12,
                'strong': passwordForm.get('newPassword')?.value.length >= 12
              }">
                <div class="strength-bar" [style.width]="(passwordForm.get('newPassword')?.value.length || 0) * 8 + '%'"></div>
              </div>
              <div class="strength-label" [ngClass]="{
                'weak': passwordForm.get('newPassword')?.value.length < 8,
                'medium': passwordForm.get('newPassword')?.value.length >= 8 && passwordForm.get('newPassword')?.value.length < 12,
                'strong': passwordForm.get('newPassword')?.value.length >= 12
              }">
                {{ passwordForm.get('newPassword')?.value.length < 8 ? 'Weak' : 
                   passwordForm.get('newPassword')?.value.length < 12 ? 'Medium' : 'Strong' }}
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="togglePasswordChange()">Cancel</button>
              <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid">Update Password</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Notifications Section -->
    <section class="security-section animate-slide-right" style="animation-delay: 100ms">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-bell"></i>
          Security Notifications
        </h2>
      </div>

      <div class="security-card">
        <div class="setting-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Login Notifications</h3>
            <p class="toggle-description">Receive notifications when there's a new login to your account</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" [checked]="securitySettings.loginNotifications" (change)="toggleLoginNotifications()">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="setting-toggle">
          <div class="toggle-info">
            <h3 class="toggle-title">Transaction Alerts</h3>
            <p class="toggle-description">Receive notifications for transactions above a certain amount</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" [checked]="securitySettings.transactionNotifications" (change)="toggleTransactionNotifications()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </section>

    <!-- Session Settings -->
    <section class="security-section animate-slide-right" style="animation-delay: 200ms">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-clock"></i>
          Session Settings
        </h2>
      </div>

      <div class="security-card">
        <div class="setting-range">
          <div class="range-info">
            <h3 class="range-title">Session Timeout</h3>
            <p class="range-description">Automatically log out after a period of inactivity</p>
          </div>
          <div class="range-control">
            <input 
              type="range" 
              min="5" 
              max="60" 
              step="5" 
              [value]="securitySettings.sessionTimeout" 
              (change)="updateSessionTimeout($event)"
              class="range-slider"
            >
            <span class="range-value">{{ securitySettings.sessionTimeout }} minutes</span>
          </div>
        </div>

        <div class="setting-range">
          <div class="range-info">
            <h3 class="range-title">Maximum Login Attempts</h3>
            <p class="range-description">Lock account after consecutive failed login attempts</p>
          </div>
          <div class="range-control">
            <input 
              type="range" 
              min="3" 
              max="10" 
              step="1" 
              [value]="securitySettings.maxLoginAttempts" 
              (change)="updateMaxLoginAttempts($event)"
              class="range-slider"
            >
            <span class="range-value">{{ securitySettings.maxLoginAttempts }} attempts</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Login History Section -->
    <section class="security-section animate-slide-right" style="animation-delay: 300ms">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-history"></i>
          Recent Login Activity
        </h2>
      </div>

      <div class="security-card">
        <div class="login-history">
          <div class="history-header">
            <span class="header-device">Device</span>
            <span class="header-location">Location</span>
            <span class="header-time">Time</span>
            <span class="header-status">Status</span>
          </div>

          <div class="history-list">
            <div class="history-item" *ngFor="let login of securitySettings.recentLogins; let i = index" 
              [style.animation-delay]="i * 50 + 'ms'">
              <div class="device-info">
                <i [class]="'fas ' + 
                  (login.deviceType === 'mobile' ? 'fa-mobile-alt' : 
                   login.deviceType === 'tablet' ? 'fa-tablet-alt' : 'fa-desktop')"></i>
                <span>{{ login.browser }} on {{ login.os }}</span>
              </div>
              <div class="location-info">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ login.location }}</span>
              </div>
              <div class="time-info">
                <i class="far fa-clock"></i>
                <span>{{ login.timestamp | date:'short' }}</span>
              </div>
              <div class="status-info" [ngClass]="{'status-success': login.successful, 'status-fail': !login.successful}">
                {{ login.successful ? 'Successful' : 'Failed' }}
              </div>
            </div>

            <div class="view-more" *ngIf="securitySettings.recentLogins.length >= 5">
              <button class="btn-text">View Complete Login History</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Connected Apps Section -->
    <section class="security-section animate-slide-right" style="animation-delay: 400ms">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-plug"></i>
          Connected Applications
        </h2>
      </div>

      <div class="security-card">
        <div class="connected-apps">
          <div class="app-item" *ngFor="let app of securitySettings.connectedApps; let i = index" 
            [style.animation-delay]="i * 100 + 'ms'">
            <div class="app-icon">
              <i [class]="'fab ' + app.icon"></i>
            </div>
            <div class="app-info">
              <h3 class="app-name">{{ app.name }}</h3>
              <p class="app-details">
                Connected on {{ app.connectedDate | date:'mediumDate' }}
                <span class="access-level" [ngClass]="app.accessLevel">{{ app.accessLevel }} access</span>
              </p>
            </div>
            <div class="app-actions">
              <button class="btn-secondary btn-sm">Revoke Access</button>
            </div>
          </div>

          <div class="empty-apps" *ngIf="securitySettings.connectedApps.length === 0">
            <div class="empty-icon">
              <i class="fas fa-plug"></i>
            </div>
            <p>You don't have any connected applications</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
